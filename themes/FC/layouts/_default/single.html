{{- define "main" -}}

{{ if not hugo.IsProduction }}
  {{- partial "debug.html" . -}}
{{ end }}

<header class="single-header">
  <h1 class="single-title">
    <span class="title">{{- .Title -}}
    {{- if .Draft -}}<sup><span class="entry-isdraft">&nbsp;&nbsp;[draft]</span></sup>{{- end -}}</span>
  </h1>
  {{- if .Description }}
  <div class="single-description">
    <span class="description">{{- .Description | $.Page.RenderString -}}</span>
  </div>
  {{- end }}
  {{/* For Download pages, call the download partial to provide download links from the latest release. */}}
  {{- if eq .Type "download" -}}
    <div class="download-header">
    {{ with (index (where site.RegularPages "Type" "releases") 0) }}
      {{- partial "download.html" . -}}
    {{ end }}
    </div>
  {{- end -}}
  {{- if eq .Type "news" -}}
  <div class="single-meta">
    <span class="meta">{{- partial "meta.html" . -}}</span>
  </div>
  {{- end -}}
  {{- partial "cover.html" . }}
</header>

{{- if (.Param "ShowToc") -}}
  {{- partial "toc.html" . -}}
{{- end -}}

{{/* Get the content of a Single Page. */}}
{{- if .Content }}
<div class="single-content">
  {{/* If using blocks (with +++ in Markdown), loops through and assigns an incremented id for each block, useful for styling. */}}
  {{ if in .RawContent "+++" }}
    {{ $count := 0 }}
    {{ $blocks := split .RawContent "+++" }}
    {{- range $blocks }}
      {{ $count = add $count 1 }}
      <section class="block" id="N{{ $count }}">
        {{ . | $.Page.RenderString }}
      </section>
    {{- end }}
  {{ else if in .RawContent "||" }}
    {{ $columns := split .RawContent "||" }}
    {{- range $columns }}
      <section class="column">
        {{ . | $.Page.RenderString }}
      </section>
    {{- end }}
  {{ else }}
    <div class="content">
      {{- .Content -}}
    </div>
  {{ end }}
</div>
{{- end }}

{{/* For Release pages, call the download partial to provide download links from the current release page. */}}
{{- if eq .Type "releases" -}}
  <section class="download-release">
      {{- partial "download.html" . -}}
  </section>
{{- end -}}

<footer class="single-footer">
  {{- if (.Param "ShowPaginationLinks") }}
  {{- partial "pagination_links.html" . }}
  {{- end }}
</footer>

{{- end -}}{{/* end main */}}
